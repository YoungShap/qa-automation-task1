# 🧾 מסמך STD — בדיקות עמוד תשלום ו-API
**שם:** אביב שפירא   

---

## 🎯 מטרת המסמך
לוודא את תקינות ויציבות **עמוד התשלום (UI)** ו־**ממשק ה־API createPaymentProcess** בסביבת הסנדבוקס.  
המטרה היא לבדוק שהתהליך מתנהל כראוי עם נתונים תקינים, ולזהות הודעות שגיאה תקינות בנתונים שגויים.

---

## 🔍 תחום הבדיקות
- עמוד התשלום למשתמש קצה.  
- קריאות API ליצירת תהליך תשלום (`createPaymentProcess`).  
- תרחישים חיוביים ושליליים הכוללים ולידציות, תקלות ותגובות מהשרת.  

---

## 🧩 סוגי בדיקות
| סוג בדיקה | תיאור |
|------------|--------|
| **פונקציונלית** | בדיקת תפקוד תקין של שדות, כפתורים ותגובות. |
| **ולידציה** | בדיקת שדות חובה, טווחים ופורמט נתונים. |
| **שלילית** | בדיקות נתונים לא תקינים או חסרים. |
| **אינטגרציה** | וידוא תקשורת בין ה־UI ל־API (כמו קבלת לינק או מעבר דף הצלחה). |
| **רגרסיה ממוקדת** | בדיקה חוזרת של תרחישים קריטיים לאחר שינויים בקוד. |

---

## 🧠 תרחישי בדיקה — ממשק המשתמש (UI)
> כתובת הסנדבוקס מוגדרת במשתנה הסביבה `PAYMENT_URL`

| # | תרחיש | שלבים | תוצאה צפויה | מכוסה באוטומציה |
|---|--------|--------|--------------|------------------|
| 1 | **תשלום תקין** | 1. גש לעמוד התשלום.<br>2. מלא שם, סכום, ופרטי כרטיס תקינים (4580-4580-4580-4580, תוקף 03/30, CVV 123).<br>3. לחץ על **שלם**. | מתקבלת הודעת הצלחה או מעבר לעמוד "תודה". | ✅ כן |
| 2 | **סכום לא תקין (0)** | 1. הזן סכום 0.<br>2. לחץ על **שלם**. | מתקבלת הודעת שגיאה "סכום לא תקין / חייב להיות גדול מ־0". | ✅ כן |
| 3 | **שדה חובה חסר** | 1. השאר את שדה הסכום ריק.<br>2. לחץ על **שלם**. | מוצגת הודעת שגיאה מתאימה ("שדה חובה"). | ⛔ לא (בדיקה ידנית) |
| 4 | **מספר כרטיס קצר מדי** | 1. הזן פחות מ־16 ספרות.<br>2. לחץ על **שלם**. | מתקבלת הודעת "מספר כרטיס לא תקין". | ⛔ לא (בדיקה ידנית) |
| 5 | **כפתור תשלום מושבת** | 1. פתח את העמוד ללא מילוי שדות.<br>2. בדוק את כפתור **שלם**. | הכפתור אמור להיות מושבת עד למילוי כל השדות. | ⛔ לא (בדיקה ידנית) |
| 6 | **בדיקת iframe של שדות כרטיס** | בדוק אם ניתן למלא את השדות גם כשהם בתוך iframe. | הזנה מתבצעת בהצלחה, ולידציות תקינות. | ✅ כן (באופן עקיף בקוד) |

---

## 🌐 תרחישי בדיקה — API (`createPaymentProcess`)
> הנתיב נקבע במשתנה הסביבה `API_URL`, וסוג הנתונים ב־`API_PAYLOAD` (`multipart` / `json`).

| # | תרחיש | נתוני בקשה | תגובה צפויה | מכוסה באוטומציה |
|---|--------|-------------|--------------|------------------|
| 1 | **בקשה תקינה** | `sum=100, currency=ILS, customerName=Test User, cardLast4=4580` | סטטוס **200**, וגוף JSON עם לינק או שדה `url`. | ✅ כן |
| 2 | **חוסר בשדה חובה** | `sum=100, customerName=Test User` (ללא currency) | סטטוס **400/422** + הודעת שגיאה "Missing / חובה". | ✅ כן |
| 3 | **ערך לא תקין (sum=0)** | `sum=0, currency=ILS, customerName=Test User` | סטטוס **400/422** + הודעה "Invalid / לא תקין / גדול מ־0". | ✅ כן |
| 4 | **מטבע לא נתמך** *(אופציונלי)* | `currency=XXX` | סטטוס **400/422** + הודעה "unsupported currency". | ⛔ לא (בדיקה ידנית עתידית) |
| 5 | **ללא הרשאה** *(אופציונלי)* | קריאה ללא טוקן | סטטוס **401/403** + הודעת שגיאה הרשאה. | ⛔ לא (בדיקה ידנית) |

---

## 🧪 נתוני בדיקה
| שדה | ערך לדוגמה |
|------|--------------|
| שם לקוח | Test User |
| מספר כרטיס | 4580-4580-4580-4580 |
| תוקף | 03/30 |
| CVV | 123 |
| סכום תקין | 100 |
| סכום לא תקין | 0 |
| מטבע | ILS |

---

## ⚙️ כלים ושימושים
- **Playwright** — להרצת בדיקות אוטומטיות (UI + API).  
- **Node.js** — סביבת הרצה.  
- **GitHub Actions** — להרצת CI/CD אוטומטית.  
 

---

## ✅ קריטריוני יציאה
- כל הבדיקות הקריטיות עברו בהצלחה (UI תקין + סכום לא תקין + API תקין ושגוי).  
- הודעות השגיאה מוצגות בהתאם.  
- דו"ח HTML של Playwright מציג 100% הצלחה.  
- ה־Pipeline ב־GitHub Actions רץ בהצלחה מלאה.

---

## ⚠️ סיכונים והנחות
- ייתכן ששדות הכרטיס ייטענו בתוך **iframe** (הטיפול כלול באוטומציה).  
- הודעות שגיאה עשויות להופיע בשפה שונה (אנגלית/עברית) — נבדק עם Regex.  
- ייתכן עיכוב רשת במעבר בין דפים (נHandled באמצעות `waitForURL`).

---

## 🔗 טבלת עקיבות 
| מזהה תרחיש | כיסוי בקובץ אוטומציה |
|-------------|---------------------|
| UI-1 | `tests/UI/payment.spec.js` — תשלום תקין |
| UI-2 | `tests/UI/payment.spec.js` — סכום לא תקין |
| UI-6 | `tests/UI/payment.spec.js` — טיפול ב־iframe |
| API-1,2,3 | `tests/API/payment.api.spec.js` — כל הבדיקות העיקריות |

---

## 🧾 סיכום
מסמך זה מתאר את כל תרחישי הבדיקה הידניים והאוטומטיים של מערכת התשלומים.  
הבדיקות מכסות תרחישים חיוביים ושליליים, כולל ולידציות, הודעות שגיאה, והתנהגות ה־API.  
האוטומציה נבנתה בתשתית Playwright עם שילוב CI/CD מלא בגיטהאב.

